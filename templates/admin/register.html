<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Create your account</title>

    <!-- Custom fonts for this template-->
    {% load static %}
    <link href="{% static 'admin/vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet" type="text/css">
    <!-- Base (optional): keep SB Admin base if needed) -->
    <link href="{% static 'admin/css/sb-admin-2.min.css' %}" rel="stylesheet">
    <!-- New modern auth CSS -->
    <link href="{% static 'admin/css/register-custom.css' %}" rel="stylesheet">

</head>

<body class="custom-auth-bg">

    <div class="auth-wrapper">
      <div class="auth-visual">
        <div class="auth-visual-inner"></div>
      </div>
      <div class="auth-card">
        <div class="brand">
          <div class="brand-badge"><i class="fas fa-user"></i></div>
          <div>
            <div class="subtitle">Welcome • Create your account</div>
            <div class="title">Join The Starks Journal</div>
          </div>
        </div>

        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" role="alert">{{ message }}</div>
          {% endfor %}
        {% endif %}

        <form method="post" class="user" novalidate>
          {% csrf_token %}
          {% if form.non_field_errors %}
            <div class="alert alert-danger" role="alert">{{ form.non_field_errors }}</div>
          {% endif %}

          <div class="form-grid">
            <div class="full input-with-icon">
              <label class="visually-hidden" for="id_username">Username</label>
              {{ form.username }}
              <i class="far fa-user field-icon"></i>
              {% if form.username.errors %}
                <div class="text-danger small" id="err-username">{{ form.username.errors|striptags }}</div>
              {% endif %}
            </div>
            <div class="full input-with-icon">
              <label class="visually-hidden" for="id_email">Email Address</label>
              {{ form.email }}
              <i class="far fa-envelope field-icon"></i>
              {% if form.email.errors %}
                <div class="text-danger small" id="err-email">{{ form.email.errors|striptags }}</div>
              {% endif %}
            </div>
            <div class="input-with-icon">
              <label class="visually-hidden" for="id_password1">Password</label>
              {{ form.password1 }}
              <i class="fas fa-lock field-icon"></i>
              {% if form.password1.errors %}
                <div class="text-danger small" id="err-password1">{{ form.password1.errors|striptags }}</div>
              {% endif %}
              <div class="strength-meter">
                <div class="strength-meter-bar"><span id="pw-meter-fill"></span></div>
                <div class="strength-label" id="pw-meter-label">Enter a password</div>
              </div>
            </div>
            <div class="input-with-icon">
              <label class="visually-hidden" for="id_password2">Repeat Password</label>
              {{ form.password2 }}
              <i class="fas fa-key field-icon"></i>
              {% if form.password2.errors %}
                <div class="text-danger small" id="err-password2">{{ form.password2.errors|striptags }}</div>
              {% endif %}
            </div>
            <div class="full input-with-icon">
              <label class="visually-hidden" for="id_birth_date">Birth date</label>
              {{ form.birth_date }}
              <i class="far fa-calendar field-icon"></i>
              {% if form.birth_date.errors %}
                <div class="text-danger small" id="err-birth_date">{{ form.birth_date.errors|striptags }}</div>
              {% endif %}
            </div>
            <div class="full">
              <button id="register-submit" type="submit" class="btn btn-primary btn-user btn-block">Create account</button>
            </div>
          </div>
        </form>

        <div class="hr-text">Already registered?</div>
        <div class="small-links">
          <div class="small"><a href="{% url 'login' %}">Back to login</a></div>
          <div class="small"><a href="#">Need help?</a></div>
        </div>
      </div>
    </div>

    <!-- Optional JS -->
    <script src="{% static 'admin/vendor/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'admin/vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'admin/vendor/jquery-easing/jquery.easing.min.js' %}"></script>
    <script src="{% static 'admin/js/sb-admin-2.min.js' %}"></script>
    <script>
      (function() {
        const input = document.getElementById('id_password1');
        const fill = document.getElementById('pw-meter-fill');
        const label = document.getElementById('pw-meter-label');
        if (!input || !fill || !label) return;

        function scorePassword(pw) {
          let score = 0;
          if (!pw) return 0;
          const length = pw.length;
          const hasLower = /[a-z]/.test(pw);
          const hasUpper = /[A-Z]/.test(pw);
          const hasNumber = /\d/.test(pw);
          const hasSymbol = /[^A-Za-z0-9]/.test(pw);
          const variety = [hasLower, hasUpper, hasNumber, hasSymbol].filter(Boolean).length;
          score += Math.min(10, length) * 6; // up to 60
          score += variety * 10; // up to 40
          return Math.min(100, score);
        }

        function updateMeter() {
          const val = input.value || '';
          const s = scorePassword(val);
          let cls = 'strength-weak';
          let text = 'Weak';
          if (s >= 70) { cls = 'strength-strong'; text = 'Strong'; }
          else if (s >= 40) { cls = 'strength-medium'; text = 'Medium'; }
          fill.className = cls;
          fill.style.width = s + '%';
          label.textContent = val ? `Password strength: ${text}` : 'Enter a password';
        }

        input.addEventListener('input', updateMeter);
        updateMeter();
      })();
    </script>
    <script>
      (function() {
        // Submit state + scroll to first error + accessibility bindings
        const form = document.querySelector('form.user');
        const submitBtn = document.getElementById('register-submit');
        if (form && submitBtn) {
          form.addEventListener('submit', () => {
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processing…';
          });
        }

        // Add aria-invalid and aria-describedby where errors exist
        const pairs = [
          ['id_username','err-username'],
          ['id_email','err-email'],
          ['id_password1','err-password1'],
          ['id_password2','err-password2'],
          ['id_birth_date','err-birth_date']
        ];
        pairs.forEach(([fid,eid])=>{
          const field = document.getElementById(fid);
          const err = document.getElementById(eid);
          if (field && err) {
            field.setAttribute('aria-invalid','true');
            field.setAttribute('aria-describedby', eid);
          }
        });

        // Scroll to first error if present
        const firstErr = document.querySelector('.text-danger');
        if (firstErr) {
          firstErr.scrollIntoView({behavior:'smooth', block:'center'});
        }
      })();
    </script>

</body>

</html>